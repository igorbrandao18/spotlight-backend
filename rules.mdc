---
alwaysApply: true
---
# Spotlight Backend - Organization Rules and Standards

## ğŸ“– Project Context

**Spotlight Backend** is a RESTful API built with NestJS for connecting creative professionals, managing projects, and optimizing creative workflows. The API enables:

- User authentication and authorization
- User profile management and social features (follow/unfollow)
- Activity feed (posts, comments, reactions)
- Project management with collaboration
- Portfolio showcase
- Real-time chat communication
- Partner stores and equipment rental
- Analytics and reporting
- Notifications system

**Type**: NestJS REST API  
**Database**: PostgreSQL with Prisma ORM  
**Focus**: Scalability, security, and maintainability

---

## ğŸŒ Language and Code Standards

### **CRITICAL RULE: Everything Must Be in English**

**All code, documentation, comments, and messages MUST be written in English:**

- âœ… **Code**: Class names, method names, variable names, constants
- âœ… **Comments**: All code comments and JSDoc
- âœ… **Documentation**: README files, API documentation, Swagger descriptions
- âœ… **Error Messages**: Exception messages, validation errors, API responses
- âœ… **Log Messages**: All log statements (INFO, WARN, ERROR, DEBUG)
- âœ… **Test Names**: Test class names, test method names, descriptions
- âœ… **Commit Messages**: Git commit messages and branch names
- âœ… **Configuration**: Property names, configuration files
- âŒ **NO Portuguese** in code, comments, or documentation
- âŒ **NO Portuguese** in error messages or API responses (unless user-facing)

**Exception**: Only user-facing messages in API responses that are specifically meant for end-users can be in Portuguese (if required by business rules), but internal code must always be in English.

---

## ğŸ› ï¸ Technology Stack

### Core
- **Framework**: NestJS 11+
- **Language**: TypeScript 5.7+
- **ORM**: Prisma 5.7+
- **Database**: PostgreSQL 14+

### Authentication & Security
- **JWT**: @nestjs/jwt for token management
- **Passport**: @nestjs/passport for authentication strategies
- **Argon2**: Password hashing (Argon2id variant) - Industry standard, more secure than BCrypt
- **BCrypt**: Legacy support for gradual migration (deprecated, will be removed)
- **CORS**: Configured for frontend origin

### Communication
- **WebSocket**: @nestjs/websockets + Socket.io for real-time chat
- **Email**: Nodemailer for transactional emails

### Storage
- **AWS S3**: File uploads (avatars, covers, images, documents)
- **Multer**: File upload handling

### Other Libraries
- **class-validator**: DTO validation
- **class-transformer**: Object transformation
- **uuid**: Unique identifier generation

---

## ğŸ“ Directory Structure

### Main Structure

```
src/
â”œâ”€â”€ auth/              # Authentication module
â”œâ”€â”€ users/             # User management module
â”œâ”€â”€ posts/             # Posts/Feed module
â”œâ”€â”€ projects/          # Project management module
â”œâ”€â”€ chat/              # Real-time chat module (WebSocket)
â”œâ”€â”€ portfolio/         # Portfolio module
â”œâ”€â”€ partner-stores/    # Partner stores module
â”œâ”€â”€ comments/          # Comments module (shared)
â”œâ”€â”€ notifications/     # Notifications module
â”œâ”€â”€ dashboard/         # Analytics/Dashboard module
â”œâ”€â”€ reports/           # Reports/Moderation module
â”œâ”€â”€ common/            # Shared utilities, guards, decorators
â”œâ”€â”€ config/            # Configuration modules
â””â”€â”€ prisma/            # Prisma service and module
```

### Module Structure Pattern

Each module should follow this structure:

```
{module}/
â”œâ”€â”€ dto/               # Data Transfer Objects
â”‚   â”œâ”€â”€ {action}-{entity}.dto.ts
â”‚   â””â”€â”€ {entity}.response.dto.ts
â”œâ”€â”€ {module}.controller.ts
â”œâ”€â”€ {module}.service.ts
â”œâ”€â”€ {module}.module.ts
â””â”€â”€ {module}.spec.ts    # Tests
```

---

## ğŸ¯ Module Implementation Checklist

### âœ… Completed Modules

- [x] **Auth Module** - Authentication, JWT, refresh tokens, password reset
- [x] **Users Module** - User CRUD, profile management, follow/unfollow, search
- [x] **Prisma Schema** - Complete database schema with all entities
- [x] **Common Infrastructure** - Guards, decorators, Prisma service

### â³ Pending Modules

- [ ] **Posts Module** - Feed posts, comments, reactions
- [ ] **Projects Module** - Project CRUD, members, milestones, archive
- [ ] **Chat Module** - WebSocket real-time chat, rooms, messages
- [ ] **Portfolio Module** - Portfolio items, media, likes, views, comments
- [ ] **Partner Stores Module** - Stores CRUD, equipment management, images
- [ ] **Comments Module** - Shared comment functionality (portfolio, posts)
- [ ] **Notifications Module** - User notifications, real-time updates
- [ ] **Dashboard Module** - Analytics, metrics, statistics
- [ ] **Reports Module** - Content moderation, user reports

---

## ğŸ” Authentication Module (`/src/auth/`)

### Structure

```
auth/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ login.dto.ts
â”‚   â”œâ”€â”€ register.dto.ts
â”‚   â”œâ”€â”€ refresh-token.dto.ts
â”‚   â”œâ”€â”€ forgot-password.dto.ts
â”‚   â”œâ”€â”€ reset-password.dto.ts
â”‚   â””â”€â”€ update-password.dto.ts
â”œâ”€â”€ strategies/
â”‚   â”œâ”€â”€ jwt.strategy.ts
â”‚   â””â”€â”€ jwt-refresh.strategy.ts
â”œâ”€â”€ auth.controller.ts
â”œâ”€â”€ auth.service.ts
â””â”€â”€ auth.module.ts
```

### Endpoints

- `POST /api/auth/register` - Register new user (Public)
- `POST /api/auth/login` - Login (Public)
- `POST /api/auth/refresh-token` - Refresh access token (Public)
- `POST /api/auth/logout` - Logout (Protected)
- `POST /api/auth/forgot-password` - Request password reset (Public)
- `POST /api/auth/reset-password` - Reset password with token (Public)
- `PUT /api/auth/update-password` - Update password (Protected)

### Response Format

**Login/Register Response:**
```typescript
{
  jwtToken: string;
  refreshToken: string;
  userId: string | number;
}
```

### Rules

- âœ… Use `@Public()` decorator for public endpoints
- âœ… Hash passwords with Argon2id (memory: 64MB, time: 3, parallelism: 4)
- âœ… Legacy BCrypt support for gradual migration (auto-migrates on login)
- âœ… Generate refresh tokens with UUID
- âœ… Store refresh tokens in database with expiration
- âœ… Validate email uniqueness on register
- âœ… Implement rate limiting for login attempts (TODO)
- âœ… Implement email service for password reset (TODO)

---

## ğŸ‘¥ Users Module (`/src/users/`)

### Structure

```
users/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ update-user-profile.dto.ts
â”‚   â””â”€â”€ change-availability.dto.ts
â”œâ”€â”€ users.controller.ts
â”œâ”€â”€ users.service.ts
â””â”€â”€ users.module.ts
```

### Endpoints

- `GET /api/users/me` - Get current user profile (Protected)
- `GET /api/users` - Search users (Protected, query: `?search=term`)
- `GET /api/users/:id/public` - Get public user profile (Protected)
- `PUT /api/users/me` - Update profile (Protected)
- `POST /api/users/follow/:id` - Follow user (Protected)
- `DELETE /api/users/unfollow/:id` - Unfollow user (Protected)
- `GET /api/users/followed` - Get followed users (Protected, query: `?userId=id`)
- `GET /api/users/followers` - Get followers (Protected, query: `?userId=id`)
- `PUT /api/users/me/:availability` - Change availability status (Protected)
- `DELETE /api/users/:id/disable` - Disable user (Protected, Admin only)
- `PUT /api/users/me/images` - Upload avatar/cover (Protected, multipart/form-data)
- `POST /api/users/me/resume` - Upload resume (Protected, multipart/form-data)
- `DELETE /api/users/me/resume` - Delete resume (Protected)
- `DELETE /api/users/me/locations/:id` - Delete location (Protected)
- `DELETE /api/users/me/social/:id` - Delete social link (Protected)
- `DELETE /api/users/me/websites/:id` - Delete website (Protected)
- `GET /api/users/preferences` - Get user preferences (Protected)
- `PUT /api/users/preferences` - Update preferences (Protected)

### Response Format

**User Profile Response:**
```typescript
{
  id: string;
  name: string;
  email: string;
  areaActivity: string;
  role: string;
  title: string;
  location: string;
  isPro: boolean;
  isVerified: boolean;
  avatar: string;
  coverImage: string;
  metrics: {
    followers: number;
    following: number;
    projects: number;
    rating: number;
  };
  bio: string;
  shortBio: string;
  specialties: string[];
  website: string;
  socialLinks: SocialLink[];
  websites: Website[];
  locations: Location[];
  profileLevel: number;
  resume: string;
  chatAvailability: string;
  industry: string;
  timeOfExperience: string;
  notableClients: string;
  whatsappNumber: string;
  availability: Availability;
  rates: Rate;
  isFollowing: boolean;
  isFollowed: boolean;
  isBlocked: boolean;
  collaborations: number;
  enabled: boolean;
}
```

### Rules

- âœ… Never expose password in responses
- âœ… Include follow status when current user is viewing profile
- âœ… Validate file types and sizes on upload
- âœ… Store files in S3/Cloudinary (TODO: implement)
- âœ… Support pagination for search results
- âœ… Calculate metrics dynamically

---

## ğŸ“ Posts Module (`/src/posts/`) - TODO

### Endpoints to Implement

- `GET /api/posts` - List posts (Protected, pagination)
- `POST /api/posts` - Create post (Protected, multipart/form-data)
- `GET /api/posts/:id` - Get post by ID (Protected)
- `PUT /api/posts/:id` - Update post (Protected, owner only)
- `DELETE /api/posts/:id` - Delete post (Protected, owner only)
- `GET /api/posts/:id/comments` - Get post comments (Protected)
- `POST /api/posts/:id/comments` - Create comment (Protected)
- `DELETE /api/posts/comments/:id` - Delete comment (Protected, owner only)
- `GET /api/posts/:id/reactions` - Get post reactions (Protected)
- `POST /api/posts/:id/reactions` - Add reaction (Protected)
- `DELETE /api/posts/:id/reactions` - Remove reaction (Protected)

### DTOs Needed

- `CreatePostDto` - content, description, equipment, location, software, image
- `UpdatePostDto` - Same as CreatePostDto
- `PostResponseDto` - Full post with author, comments count, reactions
- `CreateCommentDto` - content, parentId (for nested comments)
- `CommentResponseDto` - Comment with author info
- `CreateReactionDto` - type (LIKE, LOVE, HAHA, WOW, SAD, ANGRY)
- `ReactionResponseDto` - Reaction with user info

### Rules

- âœ… Posts can have images (multipart/form-data)
- âœ… Comments support nested replies (parentId)
- âœ… Reactions are unique per user per post
- âœ… Include author information in responses
- âœ… Support pagination for comments

---

## ğŸ¯ Projects Module (`/src/projects/`) - TODO

### Endpoints to Implement

- `GET /api/projects/list` - List projects (Protected, query: `?projectId=id&archived=true`)
- `POST /api/projects` - Create project (Protected)
- `GET /api/projects/:id` - Get project (Protected, query: `?archived=true`)
- `PUT /api/projects/:id` - Update project (Protected, owner/admin only)
- `DELETE /api/projects/:id` - Delete project (Protected, owner only)
- `PATCH /api/projects/:id/archive` - Archive project (Protected, owner only)
- `GET /api/projects/list/colaboration` - Get collaboration projects (Protected, query: `?userId=id`)
- `GET /api/projects/:id/members` - List project members (Protected)
- `POST /api/projects/:id/members` - Add member (Protected, owner/admin only)
- `DELETE /api/projects/:id/members/:memberId` - Remove member (Protected, owner/admin only)
- `GET /api/projects/:id/milestones` - List milestones (Protected)
- `POST /api/projects/:id/milestones` - Create milestone (Protected, owner/admin only)
- `PUT /api/projects/:id/milestones/:milestoneId` - Update milestone (Protected, owner/admin only)
- `DELETE /api/projects/:id/milestones/:milestoneId` - Delete milestone (Protected, owner/admin only)
- `PUT /api/projects/:id/image` - Upload project image (Protected, multipart/form-data, owner only)

### DTOs Needed

- `CreateProjectDto` - title, description, category, priority, status, members[], milestones[]
- `UpdateProjectDto` - Same as CreateProjectDto
- `ProjectResponseDto` - Full project with owner, members, milestones
- `AddMemberDto` - userId, role
- `MemberResponseDto` - User info with role
- `CreateMilestoneDto` - title, description, dueDate, status, order
- `MilestoneResponseDto` - Milestone with status

### Rules

- âœ… Projects have owner (creator)
- âœ… Members have roles: OWNER, ADMIN, MEMBER
- âœ… Only owner/admin can manage members and milestones
- âœ… Milestones have status: TODO, IN_PROGRESS, DONE
- âœ… Projects can be archived (soft delete)
- âœ… Support filtering by archived status

---

## ğŸ’¬ Chat Module (`/src/chat/`) - TODO

### WebSocket Endpoints

- `WS /api/ws` - WebSocket connection (query: `?token=jwt&room=roomId`)

### HTTP Endpoints

- `GET /api/chat` - List chat rooms (Protected)
- `GET /api/chat/:roomId` - Get room info (Protected)
- `GET /api/chat/:roomId/messages` - Get messages (Protected, pagination: `?page=0&size=20`)
- `POST /api/chat/:userId` - Create/Get chat room with user (Protected)

### WebSocket Events

**Client â†’ Server:**
- `message` - Send message
- `join` - Join room
- `leave` - Leave room
- `typing` - Typing indicator

**Server â†’ Client:**
- `message` - New message received
- `user_joined` - User joined room
- `user_left` - User left room
- `typing` - User typing

### DTOs Needed

- `ChatRoomResponseDto` - id, name, isGroup, archived, members[], createdAt
- `ChatMessageRequestDto` - content, type (TEXT, IMAGE, FILE)
- `ChatMessageResponseDto` - id, content, sender, senderName, type, createdAt
- `CreateChatRoomDto` - userId (for 1-on-1) or name, userIds[] (for group)

### Rules

- âœ… Authenticate WebSocket connections with JWT
- âœ… Support 1-on-1 and group chats
- âœ… Store messages in database
- âœ… Support pagination for message history
- âœ… Support message types: TEXT, IMAGE, FILE
- âœ… Implement typing indicators
- âœ… Archive rooms (soft delete)

---

## ğŸ¨ Portfolio Module (`/src/portfolio/`) - TODO

### Endpoints to Implement

- `GET /api/portfolio` - List portfolio items (Protected, query: `?userId=id`)
- `POST /api/portfolio` - Create portfolio item (Protected, multipart/form-data)
- `GET /api/portfolio/:id` - Get portfolio item (Protected)
- `PUT /api/portfolio/:id` - Update portfolio item (Protected, owner only)
- `DELETE /api/portfolio/:id` - Delete portfolio item (Protected, owner only)
- `POST /api/portfolio/:id/like` - Like portfolio item (Protected)
- `POST /api/portfolio/:id/unlike` - Unlike portfolio item (Protected)
- `GET /api/portfolio/:id/likes` - Get likes (Protected)
- `POST /api/portfolio/:id/view` - Record view (Protected)
- `GET /api/comments/:itemId` - Get portfolio comments (Protected, pagination)
- `POST /api/comments/:itemId` - Create comment (Protected)
- `PUT /api/comments/:itemId/:commentId` - Update comment (Protected, owner only)
- `DELETE /api/comments/:itemId/:commentId` - Delete comment (Protected, owner only)
- `POST /api/comments/:itemId/:commentId/like` - Like comment (Protected)
- `POST /api/comments/:itemId/:commentId/unlike` - Unlike comment (Protected)

### DTOs Needed

- `CreatePortfolioItemDto` - title, description, files[] (multipart)
- `UpdatePortfolioItemDto` - Same as CreatePostDto
- `PortfolioItemResponseDto` - id, title, description, media[], likeCount, viewCount, createdAt
- `CreateCommentDto` - content, parentId (for nested comments)
- `CommentResponseDto` - Comment with author, likeCount, replies[]
- `LikeResponseDto` - userId, username, likedAt

### Rules

- âœ… Portfolio items can have multiple media files
- âœ… Media types: IMAGE, VIDEO, AUDIO, DESIGN
- âœ… Track views and likes
- âœ… Comments support nested replies
- âœ… Comments can be liked
- âœ… Support pagination for comments

---

## ğŸª Partner Stores Module (`/src/partner-stores/`) - TODO

### Endpoints to Implement

- `GET /api/partner-stores` - List stores (Protected)
- `GET /api/partner-stores/:id` - Get store (Protected)
- `POST /api/partner-stores` - Create store (Protected, Admin only)
- `PUT /api/partner-stores/:id` - Update store (Protected, Admin only)
- `DELETE /api/partner-stores/:id` - Delete store (Protected, Admin only)
- `POST /api/partner-stores/:id/images` - Upload store images (Protected, multipart/form-data, Admin only)
- `GET /api/partner-stores/equipments` - List equipments (Protected, query: `?partnerStoreId=id`)
- `GET /api/partner-stores/equipments/:id` - Get equipment (Protected)
- `POST /api/partner-stores/equipments` - Create equipment (Protected, Admin only)
- `PUT /api/partner-stores/equipments/:id` - Update equipment (Protected, Admin only)
- `DELETE /api/partner-stores/equipments/:id` - Delete equipment (Protected, Admin only)
- `POST /api/partner-stores/equipments/:id/images` - Upload equipment images (Protected, multipart/form-data, Admin only)
- `DELETE /api/partner-stores/equipments/:id/images` - Delete image (Protected, query: `?key=imageKey`, Admin only)

### DTOs Needed

- `CreatePartnerStoreDto` - name, description, website, email, phone, address
- `UpdatePartnerStoreDto` - Same as CreatePartnerStoreDto
- `PartnerStoreResponseDto` - Full store with logo, coverImage, equipments[]
- `CreateEquipmentDto` - name, description, price, category, partnerStoreId
- `UpdateEquipmentDto` - Same as CreateEquipmentDto
- `EquipmentResponseDto` - Equipment with images[]

### Rules

- âœ… Stores have logo and cover image
- âœ… Equipment can have multiple images
- âœ… Only admins can manage stores and equipment
- âœ… Store images: logo, coverImage
- âœ… Equipment images: multiple files

---

## ğŸ“Š Reports Module (`/src/reports/`) - TODO

### Endpoints to Implement

- `GET /api/reports` - List reports (Protected, Admin only)
- `GET /api/reports/:id` - Get report (Protected, Admin only)
- `POST /api/reports/new` - Create report (Protected)
- `PUT /api/reports/:id` - Update report status (Protected, Admin only)

### DTOs Needed

- `CreateReportDto` - reportedUserId?, reportedProjectId?, reportedPortfolioItemId?, reason, category
- `UpdateReportDto` - conclusion, status (PENDING, REVIEWED, REJECTED, CONCLUDED)
- `ReportResponseDto` - Full report with reporter, reported content, status, conclusion

### Rules

- âœ… Reports can target users, projects, or portfolio items
- âœ… Only admins can view and update reports
- âœ… Status workflow: PENDING â†’ REVIEWED/REJECTED â†’ CONCLUDED
- âœ… Include conclusion when status is updated

---

## ğŸ”” Notifications Module (`/src/notifications/`) - TODO

### Endpoints to Implement

- `GET /api/notifications` - List notifications (Protected, pagination)
- `GET /api/notifications/:id` - Get notification (Protected)
- `PUT /api/notifications/:id/read` - Mark as read (Protected)
- `PUT /api/notifications/read-all` - Mark all as read (Protected)

### DTOs Needed

- `NotificationResponseDto` - id, type, title, message, relatedObjectId, relatedObjectType, metadata, read, createdAt

### Rules

- âœ… Notifications types: FOLLOW, COMMENT, LIKE, PROJECT_INVITE, etc.
- âœ… Support pagination
- âœ… Track read/unread status
- âœ… Include related object reference (post, project, user, etc.)
- âœ… Support metadata for additional info

---

## ğŸ“ˆ Dashboard Module (`/src/dashboard/`) - TODO

### Endpoints to Implement

- `GET /api/dashboard/stats` - Get user statistics (Protected)
- `GET /api/dashboard/analytics` - Get analytics data (Protected)

### DTOs Needed

- `DashboardStatsDto` - followers, following, projects, portfolioItems, views, likes
- `AnalyticsDto` - Various analytics metrics

### Rules

- âœ… Calculate statistics dynamically
- âœ… Include time-based analytics (daily, weekly, monthly)
- âœ… Support filtering by date range

---

## ğŸ§ª Testing Standards

### Test Structure

```
{module}/
â”œâ”€â”€ {module}.controller.spec.ts    # Controller tests
â”œâ”€â”€ {module}.service.spec.ts        # Service tests
â””â”€â”€ {module}.e2e-spec.ts           # E2E tests
```

### Test Types

1. **Unit Tests** - Test individual methods with real database (NO MOCKS)
2. **Integration Tests** - Test service + repository integration with real database
3. **E2E Tests** - Test complete HTTP request/response flow with real database

### Rules

- âœ… Use `@nestjs/testing` for test utilities
- âœ… **ALWAYS use real database** - NO mocks for Prisma service
- âœ… Use test database for all tests (unit, integration, E2E)
- âœ… Clean database before/after each test
- âœ… Test all error cases
- âœ… Test validation rules
- âœ… Use descriptive test names in English
- âœ… Each module MUST have tests for service and controller

---

## ğŸ”’ Security Rules

### Authentication

- âœ… All endpoints (except public) require JWT authentication
- âœ… Use `@Public()` decorator for public endpoints
- âœ… Validate JWT token on every request
- âœ… Refresh tokens stored in database with expiration
- âœ… Implement token blacklist for logout (TODO)

### Authorization

- âœ… Check resource ownership before update/delete
- âœ… Implement role-based access control (RBAC) for admin endpoints
- âœ… Validate user permissions in service layer

### Data Protection

- âœ… Never expose passwords in responses
- âœ… Hash passwords with Argon2id (memory: 64MB, time: 3, parallelism: 4)
- âœ… Legacy BCrypt support for gradual migration (auto-migrates on login)
- âœ… Validate and sanitize all user inputs
- âœ… Use DTOs for all request/response data
- âœ… Implement rate limiting (TODO)

### File Upload

- âœ… Validate file types (images, PDFs only)
- âœ… Limit file sizes (20MB max)
- âœ… Scan files for malware (TODO)
- âœ… Store files in S3/Cloudinary, not local filesystem

---

## ğŸ“ Code Conventions

### Naming

- **Controllers**: `{Module}Controller` (e.g., `UsersController`)
- **Services**: `{Module}Service` (e.g., `UsersService`)
- **DTOs**: `{Action}{Entity}Dto` (e.g., `CreateUserDto`, `UpdateUserDto`)
- **Response DTOs**: `{Entity}ResponseDto` (e.g., `UserResponseDto`)
- **Modules**: `{Module}Module` (e.g., `UsersModule`)

### File Organization

- âœ… One class per file
- âœ… DTOs in `dto/` folder
- âœ… Services contain business logic
- âœ… Controllers handle HTTP requests/responses
- âœ… Use dependency injection

### Validation

- âœ… Use `class-validator` decorators in DTOs
- âœ… Use `@UsePipes(ValidationPipe)` globally
- âœ… Return clear error messages
- âœ… Validate file uploads

### Error Handling

- âœ… Use NestJS built-in exceptions
- âœ… Create custom exceptions when needed
- âœ… Return appropriate HTTP status codes
- âœ… Include error details in development mode

---

## ğŸš€ Deployment Checklist

### Environment Variables

- [ ] `DATABASE_URL` - PostgreSQL connection string
- [ ] `JWT_SECRET` - Secret key for JWT (min 256 bits)
- [ ] `JWT_REFRESH_SECRET` - Secret key for refresh tokens
- [ ] `AWS_ACCESS_KEY_ID` - AWS S3 access key
- [ ] `AWS_SECRET_ACCESS_KEY` - AWS S3 secret key
- [ ] `AWS_S3_BUCKET` - S3 bucket name
- [ ] `SMTP_HOST` - Email server host
- [ ] `SMTP_USER` - Email username
- [ ] `SMTP_PASS` - Email password
- [ ] `CORS_ORIGIN` - Frontend URL

### Pre-Deployment

- [ ] Run all tests
- [ ] Generate Prisma client
- [ ] Run database migrations
- [ ] Build production bundle
- [ ] Set up environment variables
- [ ] Configure CORS
- [ ] Set up file storage (S3/Cloudinary)
- [ ] Configure email service
- [ ] Set up monitoring/logging

---

## ğŸ“š Implementation Priority

### Phase 1: Core Features (Current)
- âœ… Authentication & Authorization
- âœ… User Management
- âœ… Database Schema

### Phase 2: Social Features
- [ ] Posts/Feed Module
- [ ] Comments Module
- [ ] Follow/Unfollow System

### Phase 3: Collaboration
- [ ] Projects Module
- [ ] Portfolio Module
- [ ] Chat Module

### Phase 4: Business Features
- [ ] Partner Stores Module
- [ ] Notifications Module
- [ ] Reports Module
- [ ] Dashboard Module

### Phase 5: Enhancements
- [ ] File upload to S3/Cloudinary
- [ ] Email service implementation
- [ ] Rate limiting
- [ ] Caching (Redis)
- [ ] Search optimization
- [ ] Analytics improvements

---

## ğŸ”„ Migration from Spring Boot

### Key Differences

1. **Language**: Java â†’ TypeScript
2. **Framework**: Spring Boot â†’ NestJS
3. **ORM**: JPA/Hibernate â†’ Prisma
4. **Validation**: Bean Validation â†’ class-validator
5. **Dependency Injection**: Spring DI â†’ NestJS DI

### Migration Notes

- âœ… Keep same API endpoints structure
- âœ… Maintain same response formats
- âœ… Preserve business logic
- âœ… Update authentication flow (JWT structure)
- âœ… Migrate database schema to Prisma
- âœ… Adapt WebSocket implementation (Spring STOMP â†’ Socket.io)

---

## ğŸ“– References

- [NestJS Documentation](https://docs.nestjs.com/)
- [Prisma Documentation](https://www.prisma.io/docs)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [class-validator](https://github.com/typestack/class-validator)
- [Socket.io Documentation](https://socket.io/docs/)

---

## ğŸ—ï¸ Professional Module Architecture Pattern

### Core Principles

All modules MUST follow these professional patterns to ensure robustness, maintainability, and scalability:

#### 1. **Layered Architecture (Separation of Concerns)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller Layer                   â”‚ â† HTTP Request/Response handling
â”‚  - Receives HTTP requests            â”‚
â”‚  - Validates input (DTOs)           â”‚
â”‚  - Delegates to Service             â”‚
â”‚  - Returns formatted responses      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Layer                      â”‚ â† Business Logic
â”‚  - Contains business rules          â”‚
â”‚  - Orchestrates operations          â”‚
â”‚  - Handles transactions             â”‚
â”‚  - Returns domain objects           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Repository Layer (Prisma)          â”‚ â† Data Access
â”‚  - Database queries                 â”‚
â”‚  - Data transformations              â”‚
â”‚  - Transaction management           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Rules:**
- âœ… Controllers MUST NOT contain business logic
- âœ… Services MUST NOT access HTTP context directly
- âœ… Services MUST use PrismaService for data access
- âœ… Each layer has clear responsibilities

#### 2. **Professional Response Structure**

All API responses MUST follow a consistent, professional structure:

**Authentication/Registration Response:**
```typescript
interface AuthenticationResponse {
  tokens: {
    accessToken: string;        // JWT token
    refreshToken: string;       // Refresh token
    tokenType: 'Bearer';        // Token type
    expiresIn: number;          // Expiration in seconds
    expiresAt: Date;            // Expiration timestamp
  };
  user: {
    id: string;
    name: string;
    email: string;
    areaActivity: string | null;
    avatar: string | null;
    coverImage: string | null;
    role: string;
  };
  account: {
    status: string;
    enabled: boolean;
    firstLogin: boolean;
    plan: PlanInfo | null;
    isPro: boolean;
    isVerified: boolean;
    createdAt: Date;
  };
  session: {
    authenticatedAt: Date;
    ipAddress: string | null;
    requiresPasswordChange: boolean;
    deviceInfo?: {
      userAgent?: string;
      platform?: string;
    };
  };
}
```

**Standard Success Response:**
```typescript
interface SuccessResponse<T> {
  success: true;
  data: T;
  message?: string;
  metadata?: {
    timestamp: Date;
    requestId?: string;
  };
}
```

**Error Response:**
```typescript
interface ErrorResponse {
  success: false;
  error: {
    code: string;              // Error code (e.g., 'USER_NOT_FOUND')
    message: string;           // Human-readable message
    details?: any;             // Additional error details
    timestamp: Date;
    path?: string;             // API path
  };
}
```

**Rules:**
- âœ… Always return structured responses (never raw data)
- âœ… Include metadata when relevant (timestamps, pagination, etc.)
- âœ… Use consistent error format across all endpoints
- âœ… Include user-friendly messages
- âœ… Never expose sensitive information in errors

#### 3. **Dependency Injection Pattern**

```typescript
@Injectable()
export class {Module}Service {
  constructor(
    private readonly prisma: PrismaService,
    private readonly configService: ConfigService,
    private readonly logger: Logger,
    // ... other dependencies
  ) {}
}
```

**Rules:**
- âœ… Use constructor injection (never property injection)
- âœ… Mark services with `@Injectable()`
- âœ… Use `private readonly` for dependencies
- âœ… Inject Logger for proper logging
- âœ… Inject ConfigService for configuration

#### 4. **DTO Pattern (Data Transfer Objects)**

```typescript
// Request DTO
export class Create{Entity}Dto {
  @ApiProperty({ description: '...', example: '...' })
  @IsString()
  @IsNotEmpty()
  @MinLength(3)
  @MaxLength(100)
  name: string;
  
  @ApiProperty({ description: '...', example: '...' })
  @IsEmail()
  @IsNotEmpty()
  email: string;
}

// Response DTO
export class {Entity}ResponseDto {
  @ApiProperty()
  id: string;
  
  @ApiProperty()
  name: string;
  
  @ApiProperty()
  createdAt: Date;
  
  // ... other fields
}
```

**Rules:**
- âœ… Separate DTOs for request and response
- âœ… Use `class-validator` decorators for validation
- âœ… Use `@ApiProperty()` for Swagger documentation
- âœ… Include examples in API documentation
- âœ… Validate all inputs before processing
- âœ… Never expose internal fields (passwords, tokens, etc.)

#### 5. **Error Handling Pattern**

```typescript
// In Service
async someMethod(id: string) {
  const entity = await this.prisma.entity.findUnique({
    where: { id },
  });
  
  if (!entity) {
    throw new NotFoundException({
      code: 'ENTITY_NOT_FOUND',
      message: `Entity with ID ${id} not found`,
    });
  }
  
  if (!entity.enabled) {
    throw new BadRequestException({
      code: 'ENTITY_DISABLED',
      message: 'Entity is disabled',
    });
  }
  
  // ... business logic
}
```

**Rules:**
- âœ… Use appropriate HTTP exceptions (NotFoundException, BadRequestException, etc.)
- âœ… Include error codes for client handling
- âœ… Provide clear, user-friendly messages
- âœ… Log errors with context (userId, requestId, etc.)
- âœ… Never expose stack traces in production
- âœ… Handle Prisma errors gracefully

#### 6. **Logging Pattern**

```typescript
@Injectable()
export class {Module}Service {
  private readonly logger = new Logger({Module}Service.name);
  
  async someMethod(userId: string, data: CreateDto) {
    this.logger.log(`Creating entity for user ${userId}`);
    
    try {
      const result = await this.prisma.entity.create({
        data: { ... },
      });
      
      this.logger.log(`Entity created successfully: ${result.id}`);
      return result;
    } catch (error) {
      this.logger.error(`Failed to create entity: ${error.message}`, error.stack);
      throw error;
    }
  }
}
```

**Rules:**
- âœ… Use NestJS Logger (not console.log)
- âœ… Include context in log messages (userId, entityId, etc.)
- âœ… Log at appropriate levels:
  - `log()` - Normal operations
  - `warn()` - Warnings, deprecated usage
  - `error()` - Errors with stack traces
  - `debug()` - Debug information (development only)
- âœ… Log important operations (create, update, delete)
- âœ… Log authentication events
- âœ… Never log sensitive data (passwords, tokens, etc.)

#### 7. **Transaction Pattern**

```typescript
async createWithRelations(data: CreateDto) {
  return this.prisma.$transaction(async (tx) => {
    // Create main entity
    const entity = await tx.entity.create({
      data: { ... },
    });
    
    // Create related entities
    await tx.relatedEntity.createMany({
      data: relatedData.map(item => ({
        ...item,
        entityId: entity.id,
      })),
    });
    
    return entity;
  });
}
```

**Rules:**
- âœ… Use transactions for multi-step operations
- âœ… Rollback on any error
- âœ… Keep transactions short
- âœ… Avoid nested transactions when possible

#### 8. **Validation Pattern**

```typescript
// In DTO
export class CreateDto {
  @IsEmail({}, { message: 'Invalid email format' })
  @IsNotEmpty({ message: 'Email is required' })
  email: string;
  
  @IsString()
  @MinLength(8, { message: 'Password must be at least 8 characters' })
  @Matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/, {
    message: 'Password must contain uppercase, lowercase, and number',
  })
  password: string;
}

// In Controller
@Post()
async create(@Body() createDto: CreateDto) {
  // Validation happens automatically via ValidationPipe
  return this.service.create(createDto);
}
```

**Rules:**
- âœ… Validate at DTO level (not in service)
- âœ… Use descriptive validation messages
- âœ… Validate file types and sizes
- âœ… Sanitize inputs (trim strings, normalize emails)
- âœ… Validate business rules in service layer

#### 9. **Security Pattern**

```typescript
// In Controller
@UseGuards(JwtAuthGuard)
@Post()
async create(
  @CurrentUser() user: CurrentUserPayload,
  @Body() createDto: CreateDto,
) {
  // Check permissions
  if (user.role !== 'ADMIN' && user.id !== createDto.userId) {
    throw new ForbiddenException('Insufficient permissions');
  }
  
  return this.service.create(user.id, createDto);
}

// In Service
async create(userId: string, createDto: CreateDto) {
  // Verify ownership
  const existing = await this.prisma.entity.findUnique({
    where: { id: createDto.entityId },
  });
  
  if (existing.userId !== userId) {
    throw new ForbiddenException('You do not own this resource');
  }
  
  // ... create logic
}
```

**Rules:**
- âœ… Always verify user permissions
- âœ… Check resource ownership before operations
- âœ… Use role-based access control (RBAC)
- âœ… Never trust client-side data
- âœ… Validate user context in service layer
- âœ… Use `@Public()` decorator for public endpoints only

#### 10. **Query Optimization Pattern**

```typescript
// Good: Select only needed fields
const user = await this.prisma.user.findUnique({
  where: { id },
  select: {
    id: true,
    name: true,
    email: true,
    avatar: true,
    // Never select password
  },
});

// Good: Use include for relations
const project = await this.prisma.project.findUnique({
  where: { id },
  include: {
    owner: {
      select: {
        id: true,
        name: true,
        avatar: true,
      },
    },
    members: {
      include: {
        user: {
          select: {
            id: true,
            name: true,
          },
        },
      },
    },
  },
});

// Good: Pagination
const posts = await this.prisma.post.findMany({
  skip: (page - 1) * limit,
  take: limit,
  orderBy: { createdAt: 'desc' },
});
```

**Rules:**
- âœ… Always use `select` to limit returned fields
- âœ… Never select sensitive fields (passwords, tokens)
- âœ… Use `include` for relations (not separate queries)
- âœ… Implement pagination for list endpoints
- âœ… Use indexes for frequently queried fields
- âœ… Avoid N+1 queries

#### 11. **Module Structure Pattern**

```
{module}/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-{entity}.dto.ts
â”‚   â”œâ”€â”€ update-{entity}.dto.ts
â”‚   â”œâ”€â”€ {entity}-response.dto.ts
â”‚   â””â”€â”€ index.ts                    # Export all DTOs
â”œâ”€â”€ interfaces/
â”‚   â””â”€â”€ {module}.interfaces.ts     # TypeScript interfaces
â”œâ”€â”€ {module}.controller.ts
â”œâ”€â”€ {module}.service.ts
â”œâ”€â”€ {module}.module.ts
â””â”€â”€ {module}.spec.ts                # Tests
```

**Rules:**
- âœ… Organize DTOs in `dto/` folder
- âœ… Create interfaces for complex types
- âœ… Export DTOs from index.ts for clean imports
- âœ… Keep controllers thin (delegate to services)
- âœ… Keep services focused (single responsibility)

#### 12. **Swagger Documentation Pattern**

```typescript
@ApiTags('module-name')
@Controller('module')
export class ModuleController {
  @Post()
  @ApiOperation({
    summary: 'Create a new entity',
    description: 'Creates a new entity with the provided data',
  })
  @ApiResponse({
    status: 201,
    description: 'Entity created successfully',
    type: EntityResponseDto,
  })
  @ApiResponse({
    status: 400,
    description: 'Bad request - Validation failed',
    schema: {
      example: {
        statusCode: 400,
        message: ['email must be an email'],
        error: 'Bad Request',
      },
    },
  })
  @ApiResponse({
    status: 401,
    description: 'Unauthorized - Invalid or missing token',
  })
  async create(@Body() createDto: CreateDto) {
    return this.service.create(createDto);
  }
}
```

**Rules:**
- âœ… Document all endpoints with Swagger
- âœ… Include operation summaries and descriptions
- âœ… Document all possible responses
- âœ… Include request/response examples
- âœ… Document query parameters and path parameters
- âœ… Keep documentation up-to-date

#### 13. **Testing Pattern**

```typescript
describe('{Module}Service', () => {
  let service: {Module}Service;
  let prisma: PrismaService;
  
  beforeEach(async () => {
    // Setup test module
    const module = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();
    
    service = module.get<{Module}Service>({Module}Service);
    prisma = module.get<PrismaService>(PrismaService);
    
    // Clean database
    await TestHelpers.cleanup();
  });
  
  describe('create', () => {
    it('should create entity successfully', async () => {
      const dto = { name: 'Test', email: 'test@example.com' };
      const result = await service.create(dto);
      
      expect(result).toBeDefined();
      expect(result.name).toBe(dto.name);
    });
    
    it('should throw error when email already exists', async () => {
      // Create first entity
      await service.create({ name: 'Test', email: 'test@example.com' });
      
      // Try to create duplicate
      await expect(
        service.create({ name: 'Test2', email: 'test@example.com' })
      ).rejects.toThrow(BadRequestException);
    });
  });
});
```

**Rules:**
- âœ… Test all service methods
- âœ… Test success cases
- âœ… Test error cases
- âœ… Test validation rules
- âœ… Use real database (no mocks)
- âœ… Clean database between tests
- âœ… Use descriptive test names

### Module Quality Checklist

Before considering a module complete, verify:

- [ ] **Architecture**: Follows layered architecture pattern
- [ ] **Responses**: Returns professional, structured responses
- [ ] **DTOs**: All inputs/outputs use DTOs with validation
- [ ] **Error Handling**: Proper error handling with codes and messages
- [ ] **Logging**: Appropriate logging at all levels
- [ ] **Security**: Permission checks and ownership validation
- [ ] **Documentation**: Complete Swagger documentation
- [ ] **Tests**: Unit and integration tests for service and controller
- [ ] **Transactions**: Multi-step operations use transactions
- [ ] **Query Optimization**: Efficient queries with proper selects
- [ ] **Validation**: Input validation at DTO level
- [ ] **Code Quality**: Clean, readable, maintainable code

---

**Last updated**: 2024  
**Maintainer**: Spotlight Backend Team  
**Document Version**: 1.0
